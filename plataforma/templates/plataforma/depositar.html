<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Depósito - Jogo Sortudo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .method-card.active { border-color: #eab308; background-color: #1e293b; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .step-hidden { display: none; }
        /* Destaque para dados bancários */
        .bank-info-highlight { color: #ffffff; font-weight: 800; letter-spacing: 0.5px; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen font-sans">

    <div class="p-4 flex items-center bg-[#1e293b] border-b border-slate-700 shadow-xl">
        <a href="{% url 'home_jogo' %}" class="text-yellow-500 mr-4 text-xl"><i class="fas fa-arrow-left"></i></a>
        <h1 class="text-xl font-bold uppercase tracking-wider">Centro de Depósito</h1>
    </div>

    <div class="max-w-md mx-auto p-4 pb-20">
        
        <div class="bg-gradient-to-r from-yellow-600 to-yellow-500 p-4 rounded-2xl mb-6 shadow-lg text-slate-900">
            <p class="text-sm font-bold opacity-80">Seu Saldo Atual</p>
            <h2 class="text-3xl font-black">Kz {{ user.saldo }}</h2>
        </div>

        <form method="POST" enctype="multipart/form-data" id="depositForm">
            {% csrf_token %}

            <div id="step1">
                <label class="block mb-3 text-sm font-bold text-slate-400 uppercase">1. Escolha o Método</label>
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <div onclick="selectMethod('banco', 'BANCO')" id="btn-banco" class="method-card border-2 border-slate-700 p-3 rounded-xl text-center cursor-pointer transition-all">
                        <i class="fas fa-university text-2xl mb-1 text-yellow-500"></i>
                        <p class="text-[10px] font-bold">BANCO</p>
                    </div>
                    <div onclick="selectMethod('express', 'EXPRESS')" id="btn-express" class="method-card border-2 border-slate-700 p-3 rounded-xl text-center cursor-pointer transition-all">
                        <i class="fas fa-mobile-alt text-2xl mb-1 text-yellow-500"></i>
                        <p class="text-[10px] font-bold">EXPRESS</p>
                    </div>
                    <div onclick="selectMethod('referencia', 'REFERENCIA')" id="btn-referencia" class="method-card border-2 border-slate-700 p-3 rounded-xl text-center cursor-pointer transition-all">
                        <i class="fas fa-barcode text-2xl mb-1 text-yellow-500"></i>
                        <p class="text-[10px] font-bold">REF</p>
                    </div>
                </div>
                <input type="hidden" name="metodo" id="metodo_input">
                
                <button type="button" id="next1" onclick="goToStep2()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-black py-4 rounded-xl shadow-lg transition-all hidden uppercase">
                    Avançar para Valor <i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>

            <div id="step2" class="step-hidden mt-6">
                <label class="block mb-3 text-sm font-bold text-slate-400 uppercase">2. Valor a depositar (Kz)</label>
                <div class="grid grid-cols-3 gap-2 mb-4">
                    {% for v in valores_pre %}
                    <button type="button" onclick="setValor('{{ v }}')" class="bg-slate-800 border border-slate-700 p-3 rounded-lg font-bold hover:bg-yellow-500 hover:text-black transition-colors">
                        {{ v }}
                    </button>
                    {% endfor %}
                </div>
                <input type="number" name="valor" id="valor_input" placeholder="Ou digite o valor..." required 
                       class="w-full bg-slate-800 border-2 border-slate-700 p-4 rounded-xl mb-6 outline-none focus:border-yellow-500 text-yellow-500 font-bold text-lg">
                
                <button type="button" id="next2" onclick="goToStep3()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-black py-4 rounded-xl shadow-lg transition-all hidden uppercase">
                    Ver Dados de Pagamento <i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>

            <div id="step3" class="step-hidden mt-6">
                <label class="block mb-3 text-sm font-bold text-slate-400 uppercase">3. Realize o Pagamento</label>
                
                <div class="bg-slate-800 rounded-2xl p-5 border border-slate-700 mb-6 shadow-inner">
                    <div id="tab-banco" class="tab-content">
                        <h3 class="text-yellow-500 font-bold mb-4 text-sm"><i class="fas fa-university mr-2"></i> TRANSFERÊNCIA BANCÁRIA</h3>
                        {% for b in bancos %}
                        <div class="mb-5 p-4 bg-slate-900 rounded-xl border-l-4 border-yellow-500 shadow-md">
                            <div class="mb-3">
                                <p class="text-[10px] text-gray-400 uppercase font-bold">Instituição / Titular</p>
                                <p class="bank-info-highlight text-base uppercase">{{ b.nome_banco }} | {{ b.titular }}</p>
                            </div>
                            <p class="text-[10px] text-gray-400 uppercase font-bold">IBAN para Depósito</p>
                            <div class="flex justify-between items-center bg-black p-3 rounded-lg mt-1 border border-slate-700">
                                <span class="text-sm font-mono text-green-400 font-bold truncate mr-2">{{ b.iban }}</span>
                                <button type="button" onclick="copyText('{{ b.iban }}')" class="text-[10px] bg-yellow-600 px-3 py-1.5 rounded-md text-black font-black hover:bg-yellow-500 transition-colors">COPIAR</button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <div id="tab-express" class="tab-content">
                        <h3 class="text-yellow-500 font-bold mb-4 text-sm"><i class="fas fa-mobile-alt mr-2"></i> PAGAMENTO POR EXPRESS</h3>
                        {% for e in express %}
                        <div class="p-6 bg-slate-900 rounded-xl text-center border border-slate-700">
                            <p class="text-xs text-gray-400 mb-2 uppercase font-bold">Número de Telefone</p>
                            <p class="text-3xl font-black text-white mb-4 tracking-widest">{{ e.numero_telefone }}</p>
                            <button type="button" onclick="copyText('{{ e.numero_telefone }}')" class="w-full bg-yellow-600 p-3 rounded-lg font-black text-black text-xs uppercase hover:bg-yellow-500 transition-all shadow-md">Copiar Número</button>
                        </div>
                        {% endfor %}
                    </div>

                    <div id="tab-referencia" class="tab-content">
                        <h3 class="text-yellow-500 font-bold mb-4 text-sm"><i class="fas fa-barcode mr-2"></i> PAGAMENTO POR REFERÊNCIA</h3>
                        {% for r in referencias %}
                        <div class="p-4 bg-slate-900 rounded-xl space-y-4 border border-slate-700">
                            <div>
                                <p class="text-[10px] text-gray-400 uppercase font-bold">Empresa</p>
                                <p class="text-white font-black text-base uppercase">{{ r.empresa }}</p>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <p class="text-[10px] text-gray-400 uppercase font-bold">Entidade</p>
                                    <p class="text-yellow-500 font-black text-lg">{{ r.entidade }}</p>
                                </div>
                                <div class="text-right">
                                    <button type="button" onclick="copyText('{{ r.entidade }}')" class="text-[9px] bg-slate-700 px-2 py-1 rounded text-white font-bold uppercase">Copiar Entidade</button>
                                </div>
                            </div>
                            <div>
                                <p class="text-[10px] text-gray-400 uppercase font-bold">Referência</p>
                                <div class="flex justify-between items-center bg-black p-3 rounded-lg mt-1 border border-slate-700">
                                    <span class="font-mono text-green-400 font-black text-base">{{ r.referencia }}</span>
                                    <button type="button" onclick="copyText('{{ r.referencia }}')" class="text-[10px] bg-yellow-600 px-3 py-1.5 rounded-md text-black font-black uppercase">Copiar</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <label class="block mb-3 text-sm font-bold text-slate-400 uppercase">Confirmar Envio</label>
                <div class="bg-slate-800 p-5 rounded-2xl border border-slate-700 space-y-5 shadow-inner">
                    <input type="text" name="nome_depositante" placeholder="Seu Nome Completo (Ordenante)" required 
                           class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl outline-none focus:border-yellow-500 text-white font-medium">
                    
                    <div class="relative border-2 border-dashed border-slate-600 p-8 rounded-2xl text-center hover:border-yellow-500 transition-colors bg-slate-900/50">
                        <input type="file" name="comprovativo" id="file_input" accept="image/*" required class="absolute inset-0 opacity-0 cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl mb-3 text-slate-500"></i>
                        <p class="text-xs text-slate-400 font-bold uppercase tracking-tighter" id="file_name">Toque para anexar o comprovativo</p>
                    </div>
                </div>

                <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white font-black py-5 rounded-2xl mt-8 shadow-xl uppercase transition-all text-lg tracking-widest">
                    Finalizar Depósito <i class="fas fa-check-circle ml-2"></i>
                </button>
            </div>
        </form>
    </div>

    <script>
        function selectMethod(tabId, metodoValue) {
            // Limpa seleções anteriores
            document.querySelectorAll('.method-card').forEach(card => card.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            
            // Ativa seleção atual
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
            document.getElementById('metodo_input').value = metodoValue;
            
            // Libera próxima etapa
            document.getElementById('next1').classList.remove('hidden');
        }

        function goToStep2() {
            document.getElementById('step2').classList.remove('step-hidden');
            document.getElementById('next1').classList.add('hidden');
            document.getElementById('step2').scrollIntoView({ behavior: 'smooth' });
        }

        function setValor(val) {
            document.getElementById('valor_input').value = val;
            document.getElementById('next2').classList.remove('hidden');
        }

        // Monitora entrada manual de valor
        document.getElementById('valor_input').oninput = function() {
            if(this.value > 0) {
                document.getElementById('next2').classList.remove('hidden');
            } else {
                document.getElementById('next2').classList.add('hidden');
            }
        };

        function goToStep3() {
            document.getElementById('step3').classList.remove('step-hidden');
            document.getElementById('next2').classList.add('hidden');
            document.getElementById('step3').scrollIntoView({ behavior: 'smooth' });
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("Copiado com sucesso: " + text);
            });
        }

        document.getElementById('file_input').onchange = function() {
            if (this.files.length > 0) {
                document.getElementById('file_name').innerHTML = "Arquivo: " + this.files[0].name;
                document.getElementById('file_name').className = "text-sm text-green-400 font-black uppercase";
            }
        };

        document.getElementById('depositForm').onsubmit = function() {
            alert("Depósito enviado com sucesso! Aguarde a validação do administrador.");
        };
    </script>
</body>
</html>
